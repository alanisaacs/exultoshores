<!DOCTYPE html>
<html>
    <head>
        <link rel=stylesheet type=text/css href="{{ url_for('static', filename='styles.css') }}">
        <script>
            function showWines() {
                var htmlstring = "";
                htmlstring += "<h2>WINES</h2>";
                {% for wine in wines %}
                // wine is a list: [wineobject, countryname, regionname, som.username]
                    htmlstring += 
                        "<div class=wineItem>" +
                            "<div class=wineLabel>";
                                {% if wine[0].label_photo %}
                                    htmlstring += "<img src=/static/{{wine[0].label_photo}}>";
                                {% endif %}
                            htmlstring += "</div>" +
                            "<div class=wineInfo>" +
                                "<p><strong>{{wine[0].name}}</strong></p>";
                                // replace escapes for lt & gt with actual chars
                                // so <br> is treated as a tag not part of the string
                                var s = "{{wine[0].description}}";
                                var t = s.replace(/&lt;/g, "<");
                                var u = t.replace(/&gt;/g, ">");
                                htmlstring += "<p>" + u + "</p>";
                                htmlstring += "<p><strong>" +
                                "{{wine[0].year}} - " +
                                "{{wine[1]}} - " + // country name
                                "{{wine[2]}} - " + // region name
                                "{{wine[0].appellation}}</strong><br> " +
                                "{{wine[0].rating}} points " +
                                "${{wine[0].price}} " +
                                "{{wine[0].abv}} abv <br>";
                                // Avoid blank date_tested values breaking display
                                {% if wine[0].date_tasted %}
                                    htmlstring += "First tasted on {{wine[0].date_tasted.strftime('%Y-%m-%d')}}. ";
                                {% else %}
                                    htmlstring += "No first taste date. ";
                                {% endif %}
                                htmlstring += "Times Tasted: {{wine[0].times_tasted}}.<br>" +
                                "Purchased at {{wine[0].purchased_at}}. Entered by {{wine[3]}}." + // sommelier name
                                "</p>" +
                            "</div>" +
                        "</div>";
                {% endfor %}
                winelist.innerHTML = htmlstring;
            }
        </script>
    </head>
    <body>
        <h1>The Wine App</h1>
        <div class="subhead">
            An Exult-O-Shores Production
        </div>

        <p>
            <a href="/manageCountryRegion">Manage Countries & Regions</a> |
            <a href="/wine/new">Create a New Wine</a> |
            <a href="/wineTable">Edit Wines</a>
        </p>
        
        <div id="winelist">
            <script>showWines();</script>
        </div>
        
    </body>
</html>